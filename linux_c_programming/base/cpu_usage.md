# CPU使用率计算

解析文件 **/proc/stat** 来获取CPU的信息, 之后计算

```bash
[user]# cat /proc/stat 
cpu  174859 105 201714 893787421 4146 0 1594 23356 0 0
cpu0 18193 10 21644 111744831 344 0 461 2340 0 0
cpu1 23700 12 28238 111695548 662 0 258 3846 0 0
cpu2 21326 10 25134 111725076 701 0 194 2961 0 0
cpu3 19881 20 23611 111725883 377 0 157 2833 0 0
cpu4 21014 17 24709 111729214 323 0 130 2670 0 0
cpu5 22062 21 26171 111718130 869 0 158 3211 0 0
cpu6 18678 8 22038 111740210 259 0 108 2341 0 0
cpu7 30002 5 30167 111708526 607 0 125 3152 0 0
intr 163613326 116 10 0 0 2173 0 3 0 0 0 111813 35 15 0 0 0 0 0 0 0 0 0 0 0 0 159179 0 1834627 3 100631 4 79366 3 599766 3 2233999 3 176678 17 1150171 2 4629842 39 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ctxt 222790035
btime 1609298736
processes 11217
procs_running 1
procs_blocked 0
softirq 108317383 2 48767867 4 11157861 161058 0 32 32906980 0 15323579
```

| 顺序  | 名称         | 说明                                                            | top对应 |
| --- | ---------- | ------------------------------------------------------------- | ----- |
| 1   | user       | 从系统启动开始累计到当前时刻，处于用户态的运行时间，不包含 nice 值为负的进程                     | us    |
| 2   | nice       | 从系统启动开始累计到当前时刻，nice值为负的进程所占用的CPU时间                            | ni    |
| 3   | system     | 从系统启动开始累计到当前时刻，处于内核态的运行时间                                     | sy    |
| 4   | idle       | 从系统启动开始累计到当前时刻，除IO等待时间以外的其它等待时间                               | id    |
| 5   | iowait     | 从系统启动开始累计到当前时刻，IO等待时间                                         | wa    |
| 6   | irq        | 从系统启动开始累计到当前时刻，硬中断处理时间                                        | hi    |
| 7   | softirq    | 从系统启动开始累计到当前时刻，软中断处理时间                                        | si    |
| 8   | steal      | 丢失时间,被强制等待（involuntary wait）虚拟CPU的时间，此时hypervisor在为另一个虚拟处理器服务 | st    |
| 9   | guest      | 为在 Linux 内核控制下的客户操作系统运行虚拟 CPU 所花费的时间                          | -     |
| 10  | guest_nice | 运行 niced guest（Linux 内核控制下的guest操作系统的虚拟CPU）所花费的时间             | -     |

## References

[Linux中计算特定CPU使用率_ibless的博客-CSDN博客_cpu使用率](https://blog.csdn.net/ibless/article/details/85177175)

[Linux CPU利用率计算原理及内核实现 - Q_Quan - 博客园](https://www.cnblogs.com/qquan/articles/4686422.html)

[LINUX CPU利用率计算_浮白-CSDN博客_linux计算cpu使用率](https://blog.csdn.net/turkeyzhou/article/details/6709953)

[Accurate calculation of CPU usage given in percentage in Linux? - Stack Overflow](https://stackoverflow.com/questions/23367857/accurate-calculation-of-cpu-usage-given-in-percentage-in-linux)

[Get Overall CPU Usage on Linux | Baeldung on Linux](https://www.baeldung.com/linux/get-cpu-usage)


